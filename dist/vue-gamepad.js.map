{"version":3,"file":"index.js","sources":["lib/utils.js","lib/gamepad.js","lib/default-button-mapping.js","lib/index.js"],"sourcesContent":["/**\r\n * helper function to build all properties like lodash's _.set function\r\n * \r\n * set(object, ['x', 'y', 'z'], 'default')\r\n * console.log(object.x.y.z);\r\n *  => default\r\n * \r\n * @param {object} obj object to build properties for\r\n * @param {array} keys list of keys to nest\r\n * @param {any} value value to set\r\n */\r\nexport function set(obj, keys, value) {\r\n  obj[keys[0]] = obj[keys[0]] || {};\r\n  const tmp = obj[keys[0]];\r\n\r\n  if (keys.length > 1) {\r\n    keys.shift();\r\n    set(tmp, keys, value);\r\n  }\r\n  else {\r\n    obj[keys[0]] = value;\r\n  }\r\n\r\n  return obj;\r\n}\r\n\r\n/**\r\n * helper function to get value from a nest object like lodash's ._get function\r\n * \r\n * get({ x: { y: 0 } }, ['x', 'y', 'z'], undefined)\r\n * => undefined\r\n * \r\n * @param {object} obj object to get properties from\r\n * @param {array} keys list of keys to use\r\n * @param {any} (optional) def default value if nothing was found\r\n */\r\nexport function get(obj, keys, def = undefined) {\r\n  const tmp = obj[keys[0]];\r\n\r\n  if (keys.length > 1 && tmp) {\r\n    keys.shift();\r\n    return get(tmp, keys) || def;\r\n  }\r\n\r\n  return tmp || def;\r\n}","import { set, get } from './utils';\r\n\r\nexport default function (Vue, options = {}) {\r\n  return class Gamepad {\r\n    constructor() {\r\n      this.pressed = new Set();\r\n      this.events = {};\r\n      this.layer = 0;\r\n      this.layers = {};\r\n      this.holding = {};\r\n\r\n      window.addEventListener('gamepadconnected', this.padConnected.bind(this));\r\n      window.addEventListener('gamepaddisconnected', this.padDisconnected.bind(this));\r\n\r\n      this.animationFrame = requestAnimationFrame(this.run.bind(this));\r\n    }\r\n\r\n    /**\r\n     * gamepad was connected\r\n     * @param {GamepadEvent} event \r\n     */\r\n    padConnected(event) {\r\n      document.body.classList.add('gamepad-connected');\r\n    }\r\n\r\n    /**\r\n     * gamepad was disconnected\r\n     * @param {GamepadEvent} event \r\n     */\r\n    padDisconnected(event) {\r\n      if (this.getGamepads().length === 0) {\r\n        document.body.classList.remove('gamepad-connected');\r\n      }\r\n    }\r\n\r\n    /**\r\n     * add an event handler\r\n     * @param {string} action type of action on the button (pressed, released)\r\n     * @param {string} event name of the button event\r\n     * @param {function} callback function to trigger\r\n     * @param {object} vnode vue directive vnode\r\n     */\r\n    addListener(action, event, callback, vnode = null) {\r\n      console.log(`listening for '${action}' '${event}' on layer ${this.layer}...`);\r\n\r\n      // register the event\r\n      set(this.events, [this.layer, action, event], []);\r\n      this.events[this.layer][action][event].push({ vnode, callback });\r\n    }\r\n\r\n    /**\r\n     * remove an event handler\r\n     * @param {string} action type of action on the button (pressed, released)\r\n     * @param {string} event name of the button event\r\n     * @param {function} callback trigger function\r\n     */\r\n    removeListener(action, event, callback) {\r\n      console.log(`removing listener for '${event}' on layer ${this.layer}...`);\r\n\r\n      const events = get(this.events, [this.layer, action], []);\r\n      if (events.length > 0) {\r\n        events[event] = events[event].filter(e => e.callback !== callback);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * switch to a new layer\r\n     * @param {*} layer \r\n     */\r\n    switchToLayer(layer) {\r\n      if (this.layer != layer) {\r\n        // keep track of the old layer before we switch\r\n        this.layers[layer] = this.layer;\r\n        this.layer = layer;\r\n\r\n        console.log(`switched to layer ${this.layer}.`);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * remove a layer, delete the registered events and switch back to the old layer\r\n     * @param {*} layer \r\n     */\r\n    removeLayer(layer) {\r\n      // switch back to the previous layer\r\n      this.layer = this.layers[layer];\r\n      delete this.layers[layer];\r\n\r\n      // delete the layer events\r\n      delete this.events[layer];\r\n\r\n      console.log(`switched back to layer ${this.layer}.`);\r\n    }\r\n\r\n    /**\r\n     * main loop\r\n     */\r\n    run() {\r\n      this.getGamepads().forEach(pad => {\r\n        // check gamepad buttons\r\n        pad.buttons.forEach((button, index) => {\r\n          const name = options.buttonNames[index];\r\n\r\n          // button is pressed\r\n          if (button.pressed) {\r\n            const now = Date.now();\r\n            const events = get(this.events, [this.layer, 'pressed', name], []);\r\n\r\n            if (!this.pressed.has(name)) {\r\n              this.pressed.add(name);\r\n              this.holding[name] = now;\r\n\r\n              if (events.length > 0) {\r\n                const event = events[events.length - 1];\r\n                event.callback.call();\r\n              }\r\n            }\r\n            // button is being held\r\n            else if ((now - this.holding[name]) >= options.buttonRepeatTimeout) {\r\n              this.holding[name] = now;\r\n\r\n              if (events.length > 0) {\r\n                const event = events[events.length - 1];\r\n                event.callback.call();\r\n              }\r\n            }\r\n          }\r\n          // button was released\r\n          else if (!button.pressed && this.pressed.has(name)) {\r\n            this.pressed.delete(name);\r\n            delete this.holding[name];\r\n\r\n            const events = get(this.events, [this.layer, 'released', name], []);\r\n            if (events.length > 0) {\r\n              const event = events[events.length - 1];\r\n              event.callback.call();\r\n            }\r\n          }\r\n        });\r\n\r\n        // check gamepad axis\r\n        pad.axes.forEach((axis, index) => {\r\n        });\r\n      });\r\n\r\n      this.animationFrame = requestAnimationFrame(this.run.bind(this));\r\n    }\r\n\r\n    /**\r\n     * get an array of active gamepads\r\n     * @return {array}\r\n     */\r\n    getGamepads() {\r\n      return Array.from(navigator.getGamepads()).filter(pad => pad !== null);\r\n    }\r\n\r\n    /**\r\n     * helper function to test if a binding is valid\r\n     * @param {object} binding binding to test which includes arg & value\r\n     */\r\n    isValidBinding(binding) {\r\n      return typeof binding.arg !== 'undefined' &&\r\n            options.buttonNames.includes(binding.arg) &&\r\n            (typeof binding.value === 'function' || (typeof binding.value === 'undefined' && typeof binding.expression === 'undefined'));\r\n    }\r\n  }\r\n}","export default [\r\n  'button-a', 'button-b', 'button-x', 'button-y',\r\n  'shoulder-left', 'shoulder-right', 'trigger-left', 'trigger-right',\r\n  'button-select', 'button-start',\r\n  'left-stick-in', 'right-stick-in',\r\n  'button-dpad-up', 'button-dpad-down', 'button-dpad-left', 'button-dpad-right',\r\n  'vendor'\r\n];","import GamepadFactory from './gamepad';\r\nimport DefaultButtonMapping from './default-button-mapping';\r\n\r\nexport default {\r\n  /**\r\n   * install function\r\n   * @param {Vue} Vue \r\n   * @param {object} options \r\n   */\r\n  install(Vue, options = {}) {\r\n    const DefaultOptions = {\r\n      buttonNames: DefaultButtonMapping,\r\n      buttonRepeatTimeout: 250,\r\n      injectClasses: true,\r\n      silent: true,\r\n    };\r\n\r\n    const Gamepad = GamepadFactory(Vue, { ...DefaultOptions, ...options });\r\n    const gamepad = new Gamepad();\r\n\r\n    Vue.prototype.$gamepad = gamepad;\r\n\r\n    Vue.directive('gamepad', {\r\n      bind: (el, binding, vnode) => {\r\n        if (gamepad.isValidBinding(binding)) {\r\n          console.log(binding.modifiers);\r\n          const action = binding.modifiers.released ? 'released' : 'pressed';\r\n          const event = binding.arg;\r\n          let callback = typeof binding.value !== 'undefined' ? binding.value : vnode.data.on.click;\r\n\r\n          gamepad.addListener(action, event, callback, vnode);\r\n        }\r\n        else {\r\n          console.error(`vue-gamepad: invalid binding. '${binding.arg}' was not bound.`);\r\n        }\r\n      },\r\n      unbind: (el, binding, vnode) => {\r\n        if (gamepad.isValidBinding(binding)) {\r\n          const action = binding.modifiers.released ? 'released' : 'pressed';\r\n          const callback = typeof binding.value !== 'undefined' ? binding.value : vnode.data.on.click;\r\n          gamepad.removeListener(action, binding.arg, callback);\r\n        }\r\n        else {\r\n          console.error(`vue-gamepad: invalid binding. '${binding.arg}' was not unbound.`);\r\n        }\r\n      },\r\n    });\r\n\r\n    // Vue.directive('gamepad-data', {\r\n    //   bind: (el, binding, vnode) => {\r\n    //     console.log(`v-gamepad-data bind`);\r\n    //   },\r\n    //   unbind: (el, binding) => {\r\n    //     console.log(`v-gamepad-data unbind`);\r\n    //   },\r\n    // });\r\n\r\n    Vue.directive('gamepad-layer', {\r\n      bind: (el, binding, vnode) => {\r\n        gamepad.switchToLayer(binding.value);\r\n      },\r\n      unbind: (el, binding) => {\r\n        gamepad.removeLayer(binding.value);\r\n      },\r\n    });\r\n  }\r\n}"],"names":["set","obj","keys","value","tmp","length","shift","get","def","undefined","Vue","options","pressed","Set","events","layer","layers","holding","window","addEventListener","padConnected","bind","padDisconnected","animationFrame","requestAnimationFrame","run","event","document","body","classList","add","getGamepads","remove","action","callback","vnode","console","log","push","filter","e","forEach","pad","buttons","button","index","name","buttonNames","now","Date","has","call","buttonRepeatTimeout","delete","axes","axis","Array","from","navigator","binding","arg","includes","expression","install","DefaultOptions","DefaultButtonMapping","injectClasses","silent","Gamepad","GamepadFactory","gamepad","prototype","$gamepad","directive","el","isValidBinding","modifiers","released","data","on","click","addListener","error","unbind","removeListener","switchToLayer","removeLayer"],"mappings":"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"}