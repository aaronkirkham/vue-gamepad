{"version":3,"file":"index.js","sources":["lib/gamepad.js","lib/index.js"],"sourcesContent":["export const BUTTON_NAMES = [\n  'button-a', 'button-b', 'button-x', 'button-y',\n  'shoulder-left', 'shoulder-right', 'trigger-left', 'trigger-right',\n  'button-select', 'button-start',\n  'left-stick-in', 'right-stick-in',\n  'button-dpad-up', 'button-dpad-down', 'button-dpad-left', 'button-dpad-right',\n  'vendor'\n];\n\nexport class Gamepad {\n  constructor(Vue, options) {\n    this.pressed = new Set();\n    this.events = {};\n    this.layer = 0;\n    this.layers = {};\n\n    window.addEventListener('gamepadconnected', this.padConnected.bind(this));\n    window.addEventListener('gamepaddisconnected', this.padDisconnected.bind(this));\n\n    this.animationFrame = requestAnimationFrame(this.run.bind(this));\n  }\n\n  /**\n   * gamepad was connected\n   * @param {GamepadEvent} event \n   */\n  padConnected(event) {\n    document.body.classList.add('gamepad-connected');\n  }\n\n  /**\n   * gamepad was disconnected\n   * @param {GamepadEvent} event \n   */\n  padDisconnected(event) {\n    if (this.getGamepads().length === 0) {\n      document.body.classList.remove('gamepad-connected');\n    }\n  }\n\n  /**\n   * add an event handler\n   * @param {string} action type of action on the button (pressed, released)\n   * @param {string} event name of the button event\n   * @param {function} callback function to trigger\n   * @param {object} vnode vue directive vnode\n   */\n  addListener(action, event, callback, vnode = null) {\n    console.log(`listening for '${event}' on layer ${this.layer}...`);\n\n    // TODO: handle action\n\n    // setup the current layer if needed\n    if (typeof this.events[this.layer] === 'undefined') {\n      this.events[this.layer] = {};\n      BUTTON_NAMES.forEach(b => this.events[this.layer][b] = []);\n    }\n\n    // register the event\n    this.events[this.layer][event].push({ vnode, callback });\n    console.log(this.events[this.layer][event]);\n  }\n\n  /**\n   * remove an event handler\n   * @param {string} event name of the button event\n   * @param {function} callback trigger function\n   */\n  removeListener(event, callback) {\n    console.log(`removing listener for '${event}' on layer ${this.layer}...`);\n\n    const events = this.events[this.layer];\n    events[event] = events[event].filter(e => e.callback !== callback);\n  }\n\n  /**\n   * switch to a new layer\n   * @param {*} layer \n   */\n  switchToLayer(layer) {\n    if (this.layer != layer) {\n      // keep track of the old layer before we switch\n      this.layers[layer] = this.layer;\n      this.layer = layer;\n\n      console.log(`switched to layer ${this.layer}.`);\n    }\n  }\n\n  /**\n   * remove a layer, delete the registered events and switch back to the old layer\n   * @param {*} layer \n   */\n  removeLayer(layer) {\n    // switch back to the previous layer\n    this.layer = this.layers[layer];\n    delete this.layers[layer];\n\n    // delete the layer events\n    delete this.events[layer];\n\n    console.log(`switched back to layer ${this.layer}.`);\n  }\n\n  /**\n   * main loop\n   */\n  run() {\n    this.getGamepads().forEach(pad => {\n      // check gamepad buttons\n      pad.buttons.forEach((button, index) => {\n        const name = BUTTON_NAMES[index];\n        const events = this.events[this.layer][name];\n\n        // button is pressed\n        if (button.pressed && !this.pressed.has(name)) {\n          this.pressed.add(name);\n\n          if (events.length > 0) {\n          }\n        }\n        // button was released\n        else if (!button.pressed && this.pressed.has(name)) {\n          this.pressed.delete(name);\n\n          if (events.length > 0) {\n            const event = events[events.length - 1];\n            event.callback.call();\n          }\n        }\n      });\n    });\n\n    this.animationFrame = requestAnimationFrame(this.run.bind(this));\n  }\n\n  /**\n   * get an array of active gamepads\n   * @return {array}\n   */\n  getGamepads() {\n    return Array.from(navigator.getGamepads()).filter(pad => pad !== null);\n  }\n}","import { Gamepad, BUTTON_NAMES } from './gamepad';\n\nexport default {\n  /**\n   * install function\n   * @param {Vue} Vue \n   * @param {object} options \n   */\n  install(Vue, options = {}) {\n    const gamepad = new Gamepad(Vue, options);\n    console.log(gamepad);\n\n    Vue.prototype.$gamepad = gamepad;\n\n    Vue.directive('gamepad', {\n      bind: (el, binding, vnode) => {\n        if (binding.arg && BUTTON_NAMES.includes(binding.arg) && typeof binding.expression === 'undefined') {\n          const action = binding.modifiers.pressed ? 'pressed' : 'released';\n          const event = binding.arg;\n          let callback = typeof binding.value !== 'undefined' ? binding.value : vnode.data.on.click;\n\n          gamepad.addListener(action, event, callback, vnode);\n        }\n        else {\n          console.error(`vue-gamepad: invalid binding. '${binding.arg}' was not bound.`);\n        }\n      },\n      unbind: (el, binding, vnode) => {\n        if (binding.arg && BUTTON_NAMES.includes(binding.arg) && typeof binding.expression === 'undefined') {\n          const callback = typeof binding.value !== 'undefined' ? binding.value : vnode.data.on.click;\n          gamepad.removeListener(binding.arg, callback);\n        }\n        else {\n          console.error(`vue-gamepad: invalid binding. '${binding.arg}' was not unbound.`);\n        }\n      },\n    });\n\n    // Vue.directive('gamepad-data', {\n    //   bind: (el, binding, vnode) => {\n    //     console.log(`v-gamepad-data bind`);\n    //   },\n    //   unbind: (el, binding) => {\n    //     console.log(`v-gamepad-data unbind`);\n    //   },\n    // });\n\n    Vue.directive('gamepad-layer', {\n      bind: (el, binding, vnode) => {\n        gamepad.switchToLayer(binding.value);\n      },\n      unbind: (el, binding) => {\n        gamepad.removeLayer(binding.value);\n      },\n    });\n  }\n}"],"names":[],"mappings":"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"}