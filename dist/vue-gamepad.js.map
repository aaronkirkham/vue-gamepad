{"version":3,"file":"index.js","sources":["lib/gamepad.js","lib/default-button-mapping.js","lib/index.js"],"sourcesContent":["export default function (Vue, options = {}) {\r\n  return class Gamepad {\r\n    constructor() {\r\n      this.pressed = new Set();\r\n      this.events = {};\r\n      this.layer = 0;\r\n      this.layers = {};\r\n\r\n      window.addEventListener('gamepadconnected', this.padConnected.bind(this));\r\n      window.addEventListener('gamepaddisconnected', this.padDisconnected.bind(this));\r\n\r\n      this.animationFrame = requestAnimationFrame(this.run.bind(this));\r\n    }\r\n\r\n    /**\r\n     * gamepad was connected\r\n     * @param {GamepadEvent} event \r\n     */\r\n    padConnected(event) {\r\n      document.body.classList.add('gamepad-connected');\r\n    }\r\n\r\n    /**\r\n     * gamepad was disconnected\r\n     * @param {GamepadEvent} event \r\n     */\r\n    padDisconnected(event) {\r\n      if (this.getGamepads().length === 0) {\r\n        document.body.classList.remove('gamepad-connected');\r\n      }\r\n    }\r\n\r\n    /**\r\n     * add an event handler\r\n     * @param {string} action type of action on the button (pressed, released)\r\n     * @param {string} event name of the button event\r\n     * @param {function} callback function to trigger\r\n     * @param {object} vnode vue directive vnode\r\n     */\r\n    addListener(action, event, callback, vnode = null) {\r\n      console.log(`listening for '${event}' on layer ${this.layer}...`);\r\n\r\n      // TODO: handle action\r\n\r\n      // setup the current layer if needed\r\n      if (typeof this.events[this.layer] === 'undefined') {\r\n        this.events[this.layer] = {};\r\n        options.buttonNames.forEach(b => this.events[this.layer][b] = []);\r\n      }\r\n\r\n      // register the event\r\n      this.events[this.layer][event].push({ vnode, callback });\r\n      console.log(this.events[this.layer][event]);\r\n    }\r\n\r\n    /**\r\n     * remove an event handler\r\n     * @param {string} event name of the button event\r\n     * @param {function} callback trigger function\r\n     */\r\n    removeListener(event, callback) {\r\n      console.log(`removing listener for '${event}' on layer ${this.layer}...`);\r\n\r\n      const events = this.events[this.layer];\r\n      events[event] = events[event].filter(e => e.callback !== callback);\r\n    }\r\n\r\n    /**\r\n     * switch to a new layer\r\n     * @param {*} layer \r\n     */\r\n    switchToLayer(layer) {\r\n      if (this.layer != layer) {\r\n        // keep track of the old layer before we switch\r\n        this.layers[layer] = this.layer;\r\n        this.layer = layer;\r\n\r\n        console.log(`switched to layer ${this.layer}.`);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * remove a layer, delete the registered events and switch back to the old layer\r\n     * @param {*} layer \r\n     */\r\n    removeLayer(layer) {\r\n      // switch back to the previous layer\r\n      this.layer = this.layers[layer];\r\n      delete this.layers[layer];\r\n\r\n      // delete the layer events\r\n      delete this.events[layer];\r\n\r\n      console.log(`switched back to layer ${this.layer}.`);\r\n    }\r\n\r\n    /**\r\n     * main loop\r\n     */\r\n    run() {\r\n      this.getGamepads().forEach(pad => {\r\n        // check gamepad buttons\r\n        pad.buttons.forEach((button, index) => {\r\n          const name = options.buttonNames[index];\r\n          const events = this.events[this.layer][name];\r\n\r\n          // button is pressed\r\n          if (button.pressed && !this.pressed.has(name)) {\r\n            this.pressed.add(name);\r\n\r\n            if (events.length > 0) {\r\n            }\r\n          }\r\n          // button was released\r\n          else if (!button.pressed && this.pressed.has(name)) {\r\n            this.pressed.delete(name);\r\n\r\n            if (events.length > 0) {\r\n              const event = events[events.length - 1];\r\n              event.callback.call();\r\n            }\r\n          }\r\n        });\r\n      });\r\n\r\n      this.animationFrame = requestAnimationFrame(this.run.bind(this));\r\n    }\r\n\r\n    /**\r\n     * get an array of active gamepads\r\n     * @return {array}\r\n     */\r\n    getGamepads() {\r\n      return Array.from(navigator.getGamepads()).filter(pad => pad !== null);\r\n    }\r\n\r\n    /**\r\n     * helper function to test if a binding is valid\r\n     * @param {object} binding binding to test which includes arg & value\r\n     */\r\n    isValidBinding(binding) {\r\n      return typeof binding.arg !== 'undefined' &&\r\n            options.buttonNames.includes(binding.arg) &&\r\n            (typeof binding.value === 'function' || (typeof binding.value === 'undefined' && typeof binding.expression === 'undefined'));\r\n    }\r\n  }\r\n}","export default [\r\n  'button-a', 'button-b', 'button-x', 'button-y',\r\n  'shoulder-left', 'shoulder-right', 'trigger-left', 'trigger-right',\r\n  'button-select', 'button-start',\r\n  'left-stick-in', 'right-stick-in',\r\n  'button-dpad-up', 'button-dpad-down', 'button-dpad-left', 'button-dpad-right',\r\n  'vendor'\r\n];","import GamepadFactory from './gamepad';\r\nimport DefaultButtonMapping from './default-button-mapping';\r\n\r\nexport default {\r\n  /**\r\n   * install function\r\n   * @param {Vue} Vue \r\n   * @param {object} options \r\n   */\r\n  install(Vue, options = {}) {\r\n    const DefaultOptions = {\r\n      buttonNames: DefaultButtonMapping,\r\n      injectClasses: true,\r\n      silent: true,\r\n    };\r\n\r\n    const Gamepad = GamepadFactory(Vue, { ...DefaultOptions, ...options });\r\n    const gamepad = new Gamepad();\r\n\r\n    Vue.prototype.$gamepad = gamepad;\r\n\r\n    Vue.directive('gamepad', {\r\n      bind: (el, binding, vnode) => {\r\n        if (gamepad.isValidBinding(binding)) {\r\n          const action = binding.modifiers.pressed ? 'pressed' : 'released';\r\n          const event = binding.arg;\r\n          let callback = typeof binding.value !== 'undefined' ? binding.value : vnode.data.on.click;\r\n\r\n          gamepad.addListener(action, event, callback, vnode);\r\n        }\r\n        else {\r\n          console.error(`vue-gamepad: invalid binding. '${binding.arg}' was not bound.`);\r\n        }\r\n      },\r\n      unbind: (el, binding, vnode) => {\r\n        if (gamepad.isValidBinding(binding)) {\r\n          const callback = typeof binding.value !== 'undefined' ? binding.value : vnode.data.on.click;\r\n          gamepad.removeListener(binding.arg, callback);\r\n        }\r\n        else {\r\n          console.error(`vue-gamepad: invalid binding. '${binding.arg}' was not unbound.`);\r\n        }\r\n      },\r\n    });\r\n\r\n    // Vue.directive('gamepad-data', {\r\n    //   bind: (el, binding, vnode) => {\r\n    //     console.log(`v-gamepad-data bind`);\r\n    //   },\r\n    //   unbind: (el, binding) => {\r\n    //     console.log(`v-gamepad-data unbind`);\r\n    //   },\r\n    // });\r\n\r\n    Vue.directive('gamepad-layer', {\r\n      bind: (el, binding, vnode) => {\r\n        gamepad.switchToLayer(binding.value);\r\n      },\r\n      unbind: (el, binding) => {\r\n        gamepad.removeLayer(binding.value);\r\n      },\r\n    });\r\n  }\r\n}"],"names":["Vue","options","pressed","Set","events","layer","layers","window","addEventListener","padConnected","bind","padDisconnected","animationFrame","requestAnimationFrame","run","event","document","body","classList","add","getGamepads","length","remove","action","callback","vnode","console","log","buttonNames","forEach","b","push","filter","e","pad","buttons","button","index","name","has","delete","call","Array","from","navigator","binding","arg","includes","value","expression","install","DefaultOptions","DefaultButtonMapping","injectClasses","silent","Gamepad","GamepadFactory","gamepad","prototype","$gamepad","directive","el","isValidBinding","modifiers","data","on","click","addListener","error","unbind","removeListener","switchToLayer","removeLayer"],"mappings":"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"}