/*!
 * vue-gamepad v1.1.2
 * (c) 2020 Aaron Kirkham <aaron@kirkh.am>
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VueGamepad=t()}(this,(function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t,n){e[t[0]]=e[t[0]]||{};var i=e[t[0]];return t.length>1?(t.shift(),o(i,t,n)):e[t[0]]=n,e}function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=e[t[0]];return t.length>1&&i?(t.shift(),l(i,t)||n):i||n}var s=["button-a","button-b","button-x","button-y","shoulder-left","shoulder-right","trigger-left","trigger-right","button-select","button-start","left-stick-in","right-stick-in","button-dpad-up","button-dpad-down","button-dpad-left","button-dpad-right","vendor"],d=["left-analog-right","left-analog-down","right-analog-right","right-analog-down"],u=["left-analog-left","left-analog-up","right-analog-left","right-analog-up"];function c(e,t){return t>0?d[e]:u[e]}function h(e){return[d[e],u[e]]}function f(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(){function t(){e(this,t),this.holding={},this.events={},this.layer=0,this.layers={},window.addEventListener("gamepadconnected",this.padConnected.bind(this)),window.addEventListener("gamepaddisconnected",this.padDisconnected.bind(this)),this.animationFrame=requestAnimationFrame(this.run.bind(this))}return n(t,[{key:"padConnected",value:function(){document.body.classList.add("gamepad-connected")}},{key:"padDisconnected",value:function(){0===this.getGamepads().length&&document.body.classList.remove("gamepad-connected")}},{key:"addListener",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=t.released?"released":"pressed",s=!!t.repeat,d=l(this.events,[this.layer,r,e],[]);0===d.length&&o(this.events,[this.layer,r,e],[]),this.events[this.layer][r][e].push({vnode:a,repeat:s,callback:n}),i.injectClasses&&a&&a.elm&&a.elm.classList.add("v-gamepad","v-gamepad--".concat(e))}},{key:"removeListener",value:function(e,t,n){var i=t.released?"released":"pressed",a=l(this.events,[this.layer,i,e],[]);a.length>0&&((a=a.filter((function(e){return e.callback!==n}))).length>0?o(this.events,[this.layer,i,e],a):delete this.events[this.layer][i][e])}},{key:"switchToLayer",value:function(e){this.layer!==e&&(this.layers[e]=this.layer,this.layer=e)}},{key:"removeLayer",value:function(e){this.layer=this.layers[e],delete this.layers[e],delete this.events[e]}},{key:"run",value:function(){var e=this;this.getGamepads().forEach((function(t){t.buttons.forEach((function(t,n){var a=i.buttonNames[n];if(t.pressed){var r=l(e.events,[e.layer,"pressed",a],[]);if(r.length>0){var o=r[r.length-1],s=Date.now(),d=void 0===e.holding[a];(d||o.repeat&&s-e.holding[a]>=i.buttonRepeatTimeout)&&(e.holding[a]=s,d&&(e.holding[a]+=i.buttonInitialTimeout-i.buttonRepeatTimeout),o.callback.call())}}else if(!t.pressed&&void 0!==e.holding[a]){delete e.holding[a];var u=l(e.events,[e.layer,"released",a],[]);if(u.length>0)u[u.length-1].callback.call()}})),t.axes.forEach((function(t,n){if(t>=i.analogThreshold||t<=-i.analogThreshold){var a=c(n,t),r=l(e.events,[e.layer,"pressed",a],[]);if(r.length>0){var o=r[r.length-1],s=Date.now(),d=void 0===e.holding[a];(d||o.repeat&&s-e.holding[a]>=i.buttonRepeatTimeout)&&(e.holding[a]=s,d&&(e.holding[a]+=i.buttonInitialTimeout-i.buttonRepeatTimeout),o.callback.call())}}else{h(n).filter((function(t){return e.holding[t]})).forEach((function(t){delete e.holding[t];var n=l(e.events,[e.layer,"released",t],[]);n.length>0&&n[n.length-1].callback.call()}))}}))})),this.animationFrame=requestAnimationFrame(this.run.bind(this))}},{key:"getGamepads",value:function(){return Array.from(navigator.getGamepads()).filter((function(e){return null!==e}))}},{key:"isValidBinding",value:function(e){return void 0!==e.arg&&("function"==typeof e.value||void 0===e.value&&void 0===e.expression)}}]),t}()}return{install:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("getGamepads"in navigator){var n={analogThreshold:.5,buttonNames:s,buttonRepeatTimeout:200,buttonInitialTimeout:200,injectClasses:!0},i=f(e,r(r({},n),t)),a=new i;e.prototype.$gamepad=a,e.directive("gamepad",{bind:function(e,t,n){if(a.isValidBinding(t)){var i=void 0!==t.value?t.value:n.data.on.click;a.addListener(t.arg,t.modifiers,i,n)}else console.error("invalid binding. '".concat(t.arg,"' was not bound."))},unbind:function(e,t,n){if(a.isValidBinding(t)){var i=void 0!==t.value?t.value:n.data.on.click;a.removeListener(t.arg,t.modifiers,i)}else console.error("invalid binding. '".concat(t.arg,"' was not unbound."))}}),e.directive("gamepad-layer",{bind:function(e,t){return a.switchToLayer(t.value)},unbind:function(e,t){return a.removeLayer(t.value)}})}else console.error("vue-gamepad: your browser does not support the Gamepad API!")}}}));
//# sourceMappingURL=vue-gamepad.min.js.map
