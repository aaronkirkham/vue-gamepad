/*!
 * vue-gamepad v1.0.0
 * (c) 2018 Aaron Kirkham <aaron@kirkh.am>
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.VueGamepad=t()}(this,function(){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function o(e,t,n){e[t[0]]=e[t[0]]||{};var a=e[t[0]];return 1<t.length?(t.shift(),o(a,t,n)):e[t[0]]=n,e}function u(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0,a=e[t[0]];return 1<t.length&&a?(t.shift(),u(a,t)||n):a||n}var n=["button-a","button-b","button-x","button-y","shoulder-left","shoulder-right","trigger-left","trigger-right","button-select","button-start","left-stick-in","right-stick-in","button-dpad-up","button-dpad-down","button-dpad-left","button-dpad-right","vendor"],h=["left-analog-right","left-analog-down","right-analog-right","right-analog-down"],g=["left-analog-left","left-analog-up","right-analog-left","right-analog-up"];function a(e){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.holding={},this.events={},this.layer=0,this.layers={},window.addEventListener("gamepadconnected",this.padConnected.bind(this)),window.addEventListener("gamepaddisconnected",this.padDisconnected.bind(this)),this.animationFrame=requestAnimationFrame(this.run.bind(this))}var t,n,a;return t=e,(n=[{key:"padConnected",value:function(e){document.body.classList.add("gamepad-connected")}},{key:"padDisconnected",value:function(e){0===this.getGamepads().length&&document.body.classList.remove("gamepad-connected")}},{key:"addListener",value:function(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,i=t.released?"released":"pressed",r=!!t.repeat;this.debug("listening for '".concat(e,"' '").concat(i,"' (repeat? ").concat(r,") on layer ").concat(this.layer,"...")),0===u(this.events,[this.layer,i,e],[]).length&&o(this.events,[this.layer,i,e],[]),this.events[this.layer][i][e].push({vnode:a,repeat:r,callback:n}),c.injectClasses&&a&&a.elm&&a.elm.classList.add("v-gamepad","v-gamepad--".concat(e))}},{key:"removeListener",value:function(e,t,n){var a=t.released?"released":"pressed";this.debug("removing listener for '".concat(e,"' '").concat(a,"' on layer ").concat(this.layer,"..."));var i=u(this.events,[this.layer,a,e],[]);0<i.length&&(0<(i=i.filter(function(e){return e.callback!==n})).length?o(this.events,[this.layer,a,e],i):delete this.events[this.layer][a][e])}},{key:"switchToLayer",value:function(e){this.layer!=e&&(this.layers[e]=this.layer,this.layer=e,this.debug("switched to layer ".concat(this.layer,".")))}},{key:"removeLayer",value:function(e){this.layer=this.layers[e],delete this.layers[e],delete this.events[e],this.debug("switched back to layer ".concat(this.layer,"."))}},{key:"run",value:function(){var d=this;this.getGamepads().forEach(function(e){e.buttons.forEach(function(e,t){var n=c.buttonNames[t];if(e.pressed){var a=Date.now(),i=u(d.events,[d.layer,"pressed",n],[]);if(0<i.length){var r=i[i.length-1];(void 0===d.holding[n]||r.repeat&&a-d.holding[n]>=c.buttonRepeatTimeout)&&(d.holding[n]=a,r.callback.call())}}else if(!e.pressed&&void 0!==d.holding[n]){delete d.holding[n];var o=u(d.events,[d.layer,"released",n],[]);if(0<o.length)o[o.length-1].callback.call()}}),e.axes.forEach(function(e,t){if(e>=c.analogThreshold||e<=-c.analogThreshold){var n=(l=t,0<(s=e)?h[l]:s<0?g[l]:void 0),a=u(d.events,[d.layer,"pressed",n],[]);if(0<a.length){var i=a[a.length-1],r=Date.now();(void 0===d.holding[n]||i.repeat&&r-d.holding[n]>=c.buttonRepeatTimeout)&&(d.holding[n]=r,i.callback.call())}}else{[h[o=t],g[o]].filter(function(e){return d.holding[e]}).forEach(function(e){delete d.holding[e];var t=u(d.events,[d.layer,"released",e],[]);0<t.length&&t[t.length-1].callback.call()})}var o,l,s})}),this.animationFrame=requestAnimationFrame(this.run.bind(this))}},{key:"getGamepads",value:function(){return Array.from(navigator.getGamepads()).filter(function(e){return null!==e})}},{key:"isValidBinding",value:function(e){return void 0!==e.arg&&("function"==typeof e.value||void 0===e.value&&void 0===e.expression)}},{key:"debug",value:function(){if(!c.silent){for(var e,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];(e=console).log.apply(e,["%cvue-gamepad","background:#fc0;color:#000"].concat(n))}}},{key:"error",value:function(){for(var e,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];(e=console).error.apply(e,["%cvue-gamepad","background:#fc0;color:#000"].concat(n))}}])&&i(t.prototype,n),a&&i(t,a),e}()}return{install:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!("getGamepads"in navigator))return console.error("vue-gamepad: your browser does not support the Gamepad API!"),!1;var i=new(a(e,function(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},t=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),t.forEach(function(e){var t,n,a;t=i,a=r[n=e],n in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a})}return i}({},{analogThreshold:.5,buttonNames:n,buttonRepeatTimeout:200,injectClasses:!0,silent:!0},t)));e.prototype.$gamepad=i,e.directive("gamepad",{bind:function(e,t,n){if(i.isValidBinding(t)){var a=void 0!==t.value?t.value:n.data.on.click;i.addListener(t.arg,t.modifiers,a,n)}else i.error("invalid binding. '".concat(t.arg,"' was not bound."))},unbind:function(e,t,n){if(i.isValidBinding(t)){var a=void 0!==t.value?t.value:n.data.on.click;i.removeListener(t.arg,t.modifiers,a)}else i.error("invalid binding. '".concat(t.arg,"' was not unbound."))}}),e.directive("gamepad-layer",{bind:function(e,t,n){return i.switchToLayer(t.value)},unbind:function(e,t){return i.removeLayer(t.value)}})}}});
//# sourceMappingURL=vue-gamepad.min.js.map
