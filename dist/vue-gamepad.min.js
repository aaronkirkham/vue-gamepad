/*!
 * vue-gamepad v2.0.0
 * (c) 2020 Aaron Kirkham <aaron@kirkh.am>
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).VueGamepad=t()}(this,function(){"use strict";var n=function(){return(n=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function s(e,t,n){e[t[0]]=e[t[0]]||{};var a=e[t[0]];return 1<t.length?(t.shift(),s(a,t,n)):e[t[0]]=n,e}function l(e,t,n){void 0===n&&(n=void 0);var a=e[t[0]];return 1<t.length&&a?(t.shift(),l(a,t)||n):a||n}var d=["left-analog-right","left-analog-down","right-analog-right","right-analog-down"],u=["left-analog-left","left-analog-up","right-analog-left","right-analog-up"];function a(e,r){return t.prototype.getGamepads=function(){return function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var a=Array(e),o=0,t=0;t<n;t++)for(var i=arguments[t],r=0,s=i.length;r<s;r++,o++)a[o]=i[r];return a}(navigator.getGamepads()).filter(function(e){return null!==e})},t.prototype.validBinding=function(e){var t=void 0!==e.arg,n="function"==typeof e.value||void 0===e.value;return t&&n},t.prototype.addListener=function(e,t,n,a){var o=t.released?"released":"pressed",i=!!t.repeat;0===l(this.events,[this.layer,o,e],[]).length&&s(this.events,[this.layer,o,e],[]),this.events[this.layer][o][e].push({vnode:a,repeat:i,callback:n}),r.injectClasses&&a&&a.el&&a.el.classList.add("v-gamepad","v-gamepad--"+e)},t.prototype.removeListener=function(e,t,n){var a=t.released?"released":"pressed",o=l(this.events,[this.layer,a,e],[]);0<o.length&&(0<(o=o.filter(function(e){return e.callback!==n})).length?s(this.events,[this.layer,a,e],o):delete this.events[this.layer][a][e])},t.prototype.runPressedCallbacks=function(e){var t,n=void 0===this.holding[e],a=Date.now(),o=l(this.events,[this.layer,"pressed",e],[]);0<o.length&&(t=o[o.length-1],(n||t.repeat&&a-this.holding[e]>=r.buttonRepeatTimeout)&&(this.holding[e]=a,n&&(this.holding[e]+=r.buttonInitialTimeout-r.buttonRepeatTimeout),t.callback()))},t.prototype.runReleasedCallbacks=function(e){delete this.holding[e];var t=l(this.events,[this.layer,"released",e],[]);0<t.length&&t[t.length-1].callback()},t.prototype.update=function(){var i=this;this.getGamepads().forEach(function(e){e.buttons.forEach(function(e,t){var n=r.buttonNames[t];e.pressed?i.runPressedCallbacks(n):void 0!==i.holding[n]&&i.runReleasedCallbacks(n)}),e.axes.forEach(function(e,t){var n,a,o;e>=r.analogThreshold||e<=-r.analogThreshold?(o=t,n=0<e?d[o]:u[o],i.runPressedCallbacks(n)):[d[a=t],u[a]].filter(function(e){return i.holding[e]}).forEach(function(e){return i.runReleasedCallbacks(e)})})}),requestAnimationFrame(this.update.bind(this))},t;function t(){var e=this;this.events=[],this.holding={},this.layer=0,window.addEventListener("gamepadconnected",function(){document.body.classList.add("gamepad-connected")}),window.addEventListener("gamepaddisconnected",function(){0===e.getGamepads().length&&document.body.classList.remove("gamepad-connected")}),requestAnimationFrame(this.update.bind(this))}}var o={analogThreshold:.5,buttonNames:["button-a","button-b","button-x","button-y","shoulder-left","shoulder-right","trigger-left","trigger-right","button-select","button-start","left-stick-in","right-stick-in","button-dpad-up","button-dpad-down","button-dpad-left","button-dpad-right","vendor"],buttonRepeatTimeout:200,buttonInitialTimeout:200,injectClasses:!0};return{install:function(e,t){if(void 0===t&&(t={}),!("getGamepads"in navigator))return console.error("vue-gamepad: your browser does not support the Gamepad API!");var i=new(a(0,n(n({},o),t)));e.config.globalProperties.$gamepad=i,e.directive("gamepad",{beforeMount:function(e,t,n){var a;if(!i.validBinding(t))return console.error("vue-gamepad: invalid binding. '"+t.arg+"' was not bound.");var o=void 0!==t.value?t.value:null===(a=null==n?void 0:n.props)||void 0===a?void 0:a.onClick;i.addListener(t.arg,t.modifiers,o,n)},beforeUnmount:function(e,t,n){var a,o;i.validBinding(t)&&(o=void 0!==t.value?t.value:null===(a=null==n?void 0:n.props)||void 0===a?void 0:a.onClick,i.removeListener(t.arg,t.modifiers,o))}})}}});
