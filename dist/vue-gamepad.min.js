/*!
 * vue-gamepad v2.0.0-beta.5
 * (c) 2020 Aaron Kirkham <aaron@kirkh.am>
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).VueGamepad=t()}(this,function(){"use strict";var n=function(){return(n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};var l=["left-analog-right","left-analog-down","right-analog-right","right-analog-down"],u=["left-analog-left","left-analog-up","right-analog-left","right-analog-up"],r={analogThreshold:.5,buttonNames:["button-a","button-b","button-x","button-y","shoulder-left","shoulder-right","trigger-left","trigger-right","button-select","button-start","left-stick-in","right-stick-in","button-dpad-up","button-dpad-down","button-dpad-left","button-dpad-right","vendor"],buttonInitialTimeout:200,buttonRepeatTimeout:200,injectClasses:!0,classPrefix:"v-gamepad"};function d(e,t,n){e[t[0]]=e[t[0]]||{};var r=e[t[0]];return 1<t.length?(t.shift(),d(r,t,n)):e[t[0]]=n,e}function c(e,t,n){void 0===n&&(n=void 0);var r=e[t[0]];return 1<t.length&&r?(t.shift(),c(r,t)||n):r||n}function a(s){return void 0===s&&(s=r),e.prototype.getGamepads=function(){return function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),a=0,t=0;t<n;t++)for(var o=arguments[t],i=0,s=o.length;i<s;i++,a++)r[a]=o[i];return r}(navigator.getGamepads()).filter(function(e){return null!==e})},e.prototype.validBinding=function(e,t){var n;if(void 0===e.arg)return 0;var r="function"==typeof e.value,a="function"==typeof(null===(n=null==t?void 0:t.props)||void 0===n?void 0:n.onClick);return r||a?2:1},e.prototype.getVNodeLayer=function(t){if(t)for(var e in this.vnodeLayers)if(this.vnodeLayers[e].find(function(e){return e===t}))return e;return""},e.prototype.addListener=function(e,t,n,r){var a=t.released?"released":"pressed",o=!!t.repeat,i=this.getVNodeLayer(r);0===c(this.events,[i,a,e],[]).length&&d(this.events,[i,a,e],[]),this.events[i][a][e].push({vnode:r,repeat:o,callback:n}),s.injectClasses&&r&&r.el&&r.el.classList.add(s.classPrefix,s.classPrefix+"--"+e)},e.prototype.removeListener=function(e,t,n,r){var a=t.released?"released":"pressed",o=this.getVNodeLayer(r),i=c(this.events,[o,a,e],[]);0!==i.length&&(0<(i=i.filter(function(e){return e.callback!==n})).length?d(this.events,[o,a,e],i):delete this.events[o][a][e])},e.prototype.createLayer=function(t,e){var n=this;void 0===this.vnodeLayers[t]&&(this.vnodeLayers[t]=[]),e.dirs&&this.vnodeLayers[t].push(e),Array.isArray(e.children)&&e.children.forEach(function(e){return n.createLayer(t,e)})},e.prototype.destroyLayer=function(e){e===this.currentLayer&&(this.currentLayer=this.prevLayers[e]),delete this.prevLayers[e],delete this.vnodeLayers[e],delete this.events[e]},e.prototype.switchToLayer=function(e){void 0===e&&(e=""),e!==this.currentLayer&&(""!==e&&(this.prevLayers[e]=this.currentLayer),this.currentLayer=e)},e.prototype.switchToDefaultLayer=function(){return this.switchToLayer("")},e.prototype.runPressedCallbacks=function(e,t){var n=c(this.events,[this.currentLayer,"pressed",e],[]),r=void 0===this.holding[e],a=Date.now(),o=n[n.length-1];(r||o&&o.repeat&&a-this.holding[e]>=s.buttonRepeatTimeout)&&(this.holding[e]=a,r&&(this.holding[e]+=s.buttonInitialTimeout-s.buttonRepeatTimeout),o&&o.callback.call(null,{buttonName:e,gamepad:t}))},e.prototype.runReleasedCallbacks=function(e,t){delete this.holding[e];var n=c(this.events,[this.currentLayer,"released",e],[]);0<n.length&&n[n.length-1].callback.call(null,{buttonName:e,gamepad:t})},e.prototype.update=function(){var i=this;this.getGamepads().forEach(function(o){o.buttons.forEach(function(e,t){var n=s.buttonNames[t];e.pressed?i.runPressedCallbacks(n,o):void 0!==i.holding[n]&&i.runReleasedCallbacks(n,o)}),o.axes.forEach(function(e,t){var n,r,a;e>=s.analogThreshold||e<=-s.analogThreshold?(a=t,n=0<e?l[a]:u[a],i.runPressedCallbacks(n,o)):[l[r=t],u[r]].filter(function(e){return i.holding[e]}).forEach(function(e){return i.runReleasedCallbacks(e,o)})})}),requestAnimationFrame(this.update.bind(this))},e;function e(){var e=this;this.events={},this.holding={},this.currentLayer="",this.prevLayers={},this.vnodeLayers={},window.addEventListener("gamepadconnected",function(){document.body.classList.add(s.classPrefix+"-connected")}),window.addEventListener("gamepaddisconnected",function(){0===e.getGamepads().length&&document.body.classList.remove(s.classPrefix+"-connected")}),requestAnimationFrame(this.update.bind(this))}}return{install:function(e,t){if(!("getGamepads"in navigator))return console.error("vue-gamepad: your browser does not support the Gamepad API!");var i=new(a(n(n({},r),t)));e.config.globalProperties.$gamepad=i,e.directive("gamepad",{mounted:function(e,t,n){var r,a=i.validBinding(t,n);if(2!==a)return console.error("vue-gamepad: '"+t.arg+"' was not bound. ("+function(e){switch(e){case 0:return"missing directive argument (v-gamepad:button)";case 1:return'missing directive callback (v-gamepad:button="callback")'}return""}(a)+")"),console.log(e);var o="function"==typeof t.value?t.value:null===(r=null==n?void 0:n.props)||void 0===r?void 0:r.onClick;i.addListener(t.arg,t.modifiers,o,n)},beforeUnmount:function(e,t,n){var r,a;2===i.validBinding(t,n)&&(a="function"==typeof t.value?t.value:null===(r=null==n?void 0:n.props)||void 0===r?void 0:r.onClick,i.removeListener(t.arg,t.modifiers,a,n))}}),e.directive("gamepad-layer",{beforeMount:function(e,t,n){if(void 0===t.value)return console.error("vue-gamepad: Failed to create layer. (invalid layer value)"),console.log(e);i.createLayer(t.value,n)},unmounted:function(e,t){void 0!==t.value&&i.destroyLayer(t.value)}})}}});
