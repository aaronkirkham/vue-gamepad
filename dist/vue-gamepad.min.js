/*!
 * vue-gamepad v2.0.0-beta.6
 * (c) 2020 Aaron Kirkham <aaron@kirkh.am>
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VueGamepad=t()}(this,(function(){"use strict";var e=function(){return(e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};var t=["left-analog-right","left-analog-down","right-analog-right","right-analog-down"],n=["left-analog-left","left-analog-up","right-analog-left","right-analog-up"],r={analogThreshold:.5,buttonNames:["button-a","button-b","button-x","button-y","shoulder-left","shoulder-right","trigger-left","trigger-right","button-select","button-start","left-stick-in","right-stick-in","button-dpad-up","button-dpad-down","button-dpad-left","button-dpad-right","vendor"],buttonInitialTimeout:200,buttonRepeatTimeout:200,injectClasses:!0,classPrefix:"v-gamepad"};function a(e,t,n){e[t[0]]=e[t[0]]||{};var r=e[t[0]];return t.length>1?(t.shift(),a(r,t,n)):e[t[0]]=n,e}function o(e,t,n){void 0===n&&(n=void 0);var r=e[t[0]];return t.length>1&&r?(t.shift(),o(r,t)||n):r||n}function i(e){return void 0===e&&(e=r),function(){function r(){var t=this;this.events={},this.holding={},this.currentLayer="",this.prevLayers={},this.vnodeLayers={},window.addEventListener("gamepadconnected",(function(){document.body.classList.add(e.classPrefix+"-connected")})),window.addEventListener("gamepaddisconnected",(function(){0===t.getGamepads().length&&document.body.classList.remove(e.classPrefix+"-connected")})),requestAnimationFrame(this.update.bind(this))}return r.prototype.getGamepads=function(){return function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,s=o.length;i<s;i++,a++)r[a]=o[i];return r}(navigator.getGamepads()).filter((function(e){return null!==e}))},r.prototype.validBinding=function(e,t){var n;if(void 0===e.arg)return 0;var r="function"==typeof e.value,a="function"==typeof(null===(n=t.props)||void 0===n?void 0:n.onClick);return r||a?2:1},r.prototype.getVNodeLayer=function(e){for(var t in this.vnodeLayers){if(this.vnodeLayers[t].find((function(t){return t===e})))return t}return""},r.prototype.addListener=function(t,n,r,i){var s=n.released?"released":"pressed",l=!!n.repeat,u=this.getVNodeLayer(i);0===o(this.events,[u,s,t],[]).length&&a(this.events,[u,s,t],[]),this.events[u][s][t].push({vnode:i,repeat:l,callback:r}),e.injectClasses&&i.el&&i.el.classList.add(e.classPrefix,e.classPrefix+"--"+t)},r.prototype.removeListener=function(e,t,n,r){var i=t.released?"released":"pressed",s=this.getVNodeLayer(r),l=o(this.events,[s,i,e],[]);0!==l.length&&((l=l.filter((function(e){return e.callback!==n}))).length>0?a(this.events,[s,i,e],l):delete this.events[s][i][e])},r.prototype.createLayer=function(e,t){var n=this;void 0===this.vnodeLayers[e]&&(this.vnodeLayers[e]=[]),t.dirs&&this.vnodeLayers[e].push(t),Array.isArray(t.children)&&t.children.forEach((function(t){return n.createLayer(e,t)}))},r.prototype.destroyLayer=function(e){e===this.currentLayer&&(this.currentLayer=this.prevLayers[e]),delete this.prevLayers[e],delete this.vnodeLayers[e],delete this.events[e]},r.prototype.switchToLayer=function(e){void 0===e&&(e=""),e!==this.currentLayer&&(""!==e&&(this.prevLayers[e]=this.currentLayer),this.currentLayer=e)},r.prototype.switchToDefaultLayer=function(){return this.switchToLayer("")},r.prototype.runPressedCallbacks=function(t,n){var r=o(this.events,[this.currentLayer,"pressed",t],[]),a=void 0===this.holding[t],i=Date.now(),s=r[r.length-1];(a||s&&s.repeat&&i-this.holding[t]>=e.buttonRepeatTimeout)&&(this.holding[t]=i,a&&(this.holding[t]+=e.buttonInitialTimeout-e.buttonRepeatTimeout),s&&s.callback.call(null,{buttonName:t,gamepad:n}))},r.prototype.runReleasedCallbacks=function(e,t){delete this.holding[e];var n=o(this.events,[this.currentLayer,"released",e],[]);n.length>0&&n[n.length-1].callback.call(null,{buttonName:e,gamepad:t})},r.prototype.update=function(){var r=this;this.getGamepads().forEach((function(a){a.buttons.forEach((function(t,n){var o=e.buttonNames[n];t.pressed?r.runPressedCallbacks(o,a):void 0!==r.holding[o]&&r.runReleasedCallbacks(o,a)})),a.axes.forEach((function(o,i){if(o>=e.analogThreshold||o<=-e.analogThreshold){var s=function(e,r){return r>0?t[e]:n[e]}(i,o);r.runPressedCallbacks(s,a)}else(l=i,[t[l],n[l]]).filter((function(e){return r.holding[e]})).forEach((function(e){return r.runReleasedCallbacks(e,a)}));var l}))})),requestAnimationFrame(this.update.bind(this))},r}()}return{install:function(t,n){if(!("getGamepads"in navigator))return console.error("vue-gamepad: your browser does not support the Gamepad API!");var a=new(i(e(e({},r),n)));t.config.globalProperties.$gamepad=a,t.directive("gamepad",{mounted:function(e,t,n){var r,o=a.validBinding(t,n);if(2!==o)return console.error("vue-gamepad: '"+t.arg+"' was not bound. ("+function(e){return 0===e?"missing directive arg (v-gamepad:button)":1===e?'missing directive callback (v-gamepad:button="callback")':""}(o)+")"),console.log(e);var i="function"==typeof t.value?t.value:null===(r=n.props)||void 0===r?void 0:r.onClick;a.addListener(t.arg,t.modifiers,i,n)},beforeUnmount:function(e,t,n){var r;if(2===a.validBinding(t,n)){var o="function"==typeof t.value?t.value:null===(r=n.props)||void 0===r?void 0:r.onClick;a.removeListener(t.arg,t.modifiers,o,n)}}}),t.directive("gamepad-layer",{beforeMount:function(e,t,n){if(void 0===t.value)return console.error("vue-gamepad: Failed to create layer. (invalid layer value)"),console.log(e);a.createLayer(t.value,n)},unmounted:function(e,t){void 0!==t.value&&a.destroyLayer(t.value)}})}}}));
