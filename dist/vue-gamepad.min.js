/*!
 * vue-gamepad v1.0.0
 * (c) 2018 Aaron Kirkham <aaron@kirkh.am>
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.VueGamepad=t()}(this,function(){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function o(e,t,n){e[t[0]]=e[t[0]]||{};var a=e[t[0]];return 1<t.length?(t.shift(),o(a,t,n)):e[t[0]]=n,e}function d(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0,a=e[t[0]];return 1<t.length&&a?(t.shift(),d(a,t)||n):a||n}var n=["button-a","button-b","button-x","button-y","shoulder-left","shoulder-right","trigger-left","trigger-right","button-select","button-start","left-stick-in","right-stick-in","button-dpad-up","button-dpad-down","button-dpad-left","button-dpad-right","vendor"];function a(e){var s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.holding={},this.events={},this.layer=0,this.layers={},window.addEventListener("gamepadconnected",this.padConnected.bind(this)),window.addEventListener("gamepaddisconnected",this.padDisconnected.bind(this)),this.animationFrame=requestAnimationFrame(this.run.bind(this))}var t,n,a;return t=e,(n=[{key:"padConnected",value:function(e){document.body.classList.add("gamepad-connected")}},{key:"padDisconnected",value:function(e){0===this.getGamepads().length&&document.body.classList.remove("gamepad-connected")}},{key:"addListener",value:function(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=t.released?"released":"pressed",i=!!t.repeat;this.debug("listening for '".concat(e,"' '").concat(r,"' (repeat? ").concat(i,") on layer ").concat(this.layer,"...")),0===d(this.events,[this.layer,r,e],[]).length&&o(this.events,[this.layer,r,e],[]),this.events[this.layer][r][e].push({vnode:a,repeat:i,callback:n}),s.injectClasses&&a&&a.elm&&a.elm.classList.add("v-gamepad","v-gamepad--".concat(e))}},{key:"removeListener",value:function(e,t,n){var a=t.released?"released":"pressed";this.debug("removing listener for '".concat(e,"' '").concat(a,"' on layer ").concat(this.layer,"..."));var r=d(this.events,[this.layer,a,e],[]);0<r.length&&(0<(r=r.filter(function(e){return e.callback!==n})).length?o(this.events,[this.layer,a,e],r):delete this.events[this.layer][a][e])}},{key:"switchToLayer",value:function(e){this.layer!=e&&(this.layers[e]=this.layer,this.layer=e,this.debug("switched to layer ".concat(this.layer,".")))}},{key:"removeLayer",value:function(e){this.layer=this.layers[e],delete this.layers[e],delete this.events[e],this.debug("switched back to layer ".concat(this.layer,"."))}},{key:"run",value:function(){var l=this;this.getGamepads().forEach(function(e){e.buttons.forEach(function(e,t){var n=s.buttonNames[t];if(e.pressed){var a=Date.now(),r=d(l.events,[l.layer,"pressed",n],[]);if(0<r.length){var i=r[r.length-1];(void 0===l.holding[n]||i.repeat&&a-l.holding[n]>=s.buttonRepeatTimeout)&&(l.holding[n]=a,i.callback.call())}}else if(!e.pressed&&void 0!==l.holding[n]){delete l.holding[n];var o=d(l.events,[l.layer,"released",n],[]);if(0<o.length)o[o.length-1].callback.call()}}),e.axes.forEach(function(e,t){if(e>=s.analogThreshold||e<=-s.analogThreshold){var n=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;if(n<=t){if(0===e)return"left-analog-right";if(1===e)return"left-analog-down";if(2===e)return"right-analog-right";if(3===e)return"right-analog-down"}else if(t<=-n){if(0===e)return"left-analog-left";if(1===e)return"left-analog-up";if(2===e)return"right-analog-left";if(3===e)return"right-analog-up"}}(t,e,s.analogThreshold),a=d(l.events,[l.layer,"pressed",n],[]);if(0<a.length){var r=a[a.length-1],i=Date.now();(void 0===l.holding[n]||r.repeat&&i-l.holding[n]>=s.buttonRepeatTimeout)&&(l.holding[n]=i,r.callback.call())}}})}),this.animationFrame=requestAnimationFrame(this.run.bind(this))}},{key:"getGamepads",value:function(){return Array.from(navigator.getGamepads()).filter(function(e){return null!==e})}},{key:"isValidBinding",value:function(e){return void 0!==e.arg&&("function"==typeof e.value||void 0===e.value&&void 0===e.expression)}},{key:"debug",value:function(){if(!s.silent){for(var e,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];(e=console).log.apply(e,["%cvue-gamepad","background:#fc0;color:#000"].concat(n))}}},{key:"error",value:function(){for(var e,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];(e=console).error.apply(e,["%cvue-gamepad","background:#fc0;color:#000"].concat(n))}}])&&r(t.prototype,n),a&&r(t,a),e}()}return{install:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!("getGamepads"in navigator))return console.error("vue-gamepad: your browser does not support the Gamepad API!"),!1;var r=new(a(e,function(r){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},t=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),t.forEach(function(e){var t,n,a;t=r,a=i[n=e],n in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a})}return r}({},{analogThreshold:.5,buttonNames:n,buttonRepeatTimeout:200,injectClasses:!0,silent:!0},t)));e.prototype.$gamepad=r,e.directive("gamepad",{bind:function(e,t,n){if(r.isValidBinding(t)){var a=void 0!==t.value?t.value:n.data.on.click;r.addListener(t.arg,t.modifiers,a,n)}else r.error("invalid binding. '".concat(t.arg,"' was not bound."))},unbind:function(e,t,n){if(r.isValidBinding(t)){var a=void 0!==t.value?t.value:n.data.on.click;r.removeListener(t.arg,t.modifiers,a)}else r.error("invalid binding. '".concat(t.arg,"' was not unbound."))}}),e.directive("gamepad-layer",{bind:function(e,t,n){return r.switchToLayer(t.value)},unbind:function(e,t){return r.removeLayer(t.value)}})}}});
//# sourceMappingURL=vue-gamepad.min.js.map
